From 37fb0cb4f454a02fcc11a246af8e0225873e19e5 Mon Sep 17 00:00:00 2001
From: Jedediah Smith <jedediah@silencegreys.com>
Date: Tue, 22 Jan 2013 14:12:03 -0500
Subject: [PATCH] Add onGround API


diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java
index 72c9bbe..db06ee8 100644
--- a/src/main/java/net/minecraft/server/PlayerConnection.java
+++ b/src/main/java/net/minecraft/server/PlayerConnection.java
@@ -563,6 +563,7 @@ public class PlayerConnection implements PacketListenerPlayIn, ITickable {
                         Player player = this.getPlayer();
                         Location from = new Location(player.getWorld(), lastPosX, lastPosY, lastPosZ, lastYaw, lastPitch); // Get the Players previous Event location.
                         Location to = player.getLocation().clone(); // Start off the To location as the Players current location.
+                        boolean wasOnGround = this.player.onGround; // SportBukkit - on-ground API
 
                         // If the packet contains movement information then we update the To location with the correct XYZ.
                         if (packetplayinflying.hasPos) {
@@ -624,6 +625,12 @@ public class PlayerConnection implements PacketListenerPlayIn, ITickable {
                         this.B &= !this.player.hasEffect(MobEffects.LEVITATION) && !this.player.cB() && !worldserver.d(this.player.getBoundingBox().g(0.0625D).a(0.0D, -0.55D, 0.0D));
                         this.player.onGround = packetplayinflying.a();
                         this.minecraftServer.getPlayerList().d(this.player);
+                        // SportBukkit start
+                        if(wasOnGround != this.player.onGround) {
+                            org.bukkit.event.player.PlayerOnGroundEvent onGroundEvent = new org.bukkit.event.player.PlayerOnGroundEvent(player, this.player.onGround);
+                            this.server.getPluginManager().callEvent(onGroundEvent);
+                        }
+                        // SportBukkit end
                         this.player.a(this.player.locY - d3, packetplayinflying.a());
                         this.o = this.player.locX;
                         this.p = this.player.locY;
-- 
1.9.0

